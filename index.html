<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Monitor BNB Wallet</title>
<style>
body {font-family: Arial, sans-serif; background:#0b0c10; color:#fff; text-align:center;}
.card {background:#1f2833; margin:20px auto; padding:20px; border-radius:12px; width:90%; max-width:500px;}
h1 {color:#66fcf1;}
table {width:100%; border-collapse:collapse; margin-top:15px;}
td,th {padding:8px; border-bottom:1px solid #45a29e;}
.value {font-size:18px; margin:10px 0;}
</style>
</head>
<body>

<div class="card">
  <h1>Carteira Monitorada</h1>
  <p id="wallet">0x4A0153E289b475Fd8693f415C00813dC77b50E64</p>

  <div class="value">💰 Saldo em BNB: <span id="bnb">-</span></div>
  <div class="value">💵 USD: <span id="usd">-</span></div>
  <div class="value">🇧🇷 BRL: <span id="brl">-</span></div>
  <div class="value">📈 BNB 24h: <span id="change">-</span></div>

  <h2>Transações Recebidas</h2>
  <table id="txTable">
    <tr><th>Hash</th><th>De</th><th>Valor (BNB)</th></tr>
  </table>
  <div id="noTx" style="display:none; margin-top:10px;">Nenhuma transação recebida.</div>
</div>

<script>
const ADDRESS = "0x4A0153E289b475Fd8693f415C00813dC77b50E64".toLowerCase();
const BSCSCAN_API_KEY = "ESBZ6MIBSP39YA2PPTJDBYSG7N2IHH7QJA"; // Universal (Etherscan API Suite)
const BSCSCAN_URL = `https://api.bscscan.com/api`;

async function getBNBPrice() {
  const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd,brl&include_24hr_change=true");
  const data = await res.json();
  return data.binancecoin;
}

async function getBalance() {
  const res = await fetch(`${BSCSCAN_URL}?module=account&action=balance&address=${ADDRESS}&apikey=${BSCSCAN_API_KEY}`);
  const data = await res.json();
  if (!data.result || isNaN(data.result)) {
    console.warn("Erro ao obter saldo:", data);
    return 0;
  }
  return Number(data.result) / 1e18;
}

async function getTransactions() {
  const res = await fetch(`${BSCSCAN_URL}?module=account&action=txlist&address=${ADDRESS}&startblock=0&endblock=99999999&sort=desc&apikey=${BSCSCAN_API_KEY}`);
  const data = await res.json();

  // Log para debug — veja no console
  console.log("Retorno da BscScan:", data);

  // Corrigido: alguns retornos vêm com result string, não array
  if (data.status !== "1" || !Array.isArray(data.result)) {
    console.warn("⚠️ Nenhuma transação válida encontrada ou erro:", data.message);
    return [];
  }

  // Filtra apenas transações recebidas
  return data.result.filter(tx => tx.to && tx.to.toLowerCase() === ADDRESS);
}

async function loadData() {
  try {
    const [bnbPrice, balance, txs] = await Promise.all([
      getBNBPrice(),
      getBalance(),
      getTransactions()
    ]);

    document.getElementById("bnb").textContent = balance.toFixed(6);
    document.getElementById("usd").textContent = `$ ${(balance * bnbPrice.usd).toFixed(2)}`;
    document.getElementById("brl").textContent = `R$ ${(balance * bnbPrice.brl).toFixed(2)}`;
    document.getElementById("change").textContent = `${bnbPrice.usd_24h_change.toFixed(2)}%`;

    const table = document.getElementById("txTable");
    const noTx = document.getElementById("noTx");

    if (txs.length === 0) {
      noTx.style.display = "block";
      return;
    }

    noTx.style.display = "none";
    txs.forEach(tx => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><a href="https://bscscan.com/tx/${tx.hash}" target="_blank" style="color:#66fcf1">${tx.hash.slice(0,10)}...</a></td>
        <td>${tx.from.slice(0,10)}...</td>
        <td>${(tx.value/1e18).toFixed(5)}</td>`;
      table.appendChild(row);
    });
  } catch (err) {
    console.error("Erro geral:", err);
  }
}

loadData();
</script>
</body>
</html>
