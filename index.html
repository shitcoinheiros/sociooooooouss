<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monitor de Carteira BNB</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #0e1117;
    color: #fff;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #f3ba2f;
  }
  .card {
    background: #161b22;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(243,186,47,0.2);
    margin: 20px auto;
    max-width: 600px;
  }
  .info {
    font-size: 16px;
    margin-bottom: 10px;
  }
  .positive { color: #00ff88; }
  .negative { color: #ff4d4d; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    padding: 8px;
    border-bottom: 1px solid #333;
    text-align: left;
  }
  a {
    color: #f3ba2f;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
  .no-tx {
    text-align: center;
    color: #888;
    margin-top: 10px;
  }
</style>
</head>
<body>

<h1>Monitor de Carteira BNB</h1>
<div class="card">
  <div id="wallet-info" class="info">Carregando dados...</div>
  <table id="tx-table">
    <thead>
      <tr>
        <th>Data</th>
        <th>De</th>
        <th>Valor (BNB)</th>
        <th>Tx</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="no-tx" class="no-tx" style="display:none;">Nenhuma transação recebida encontrada.</div>
</div>

<script>
const ADDRESS = "0x4A0153E289b475Fd8693f415C00813dC77b50E64".toLowerCase();
const BSCSCAN_API_KEY = "ESBZ6MIBSP39YA2PPTJDBYSG7N2IHH7QJA"; // 🔑 Chave da API BscScan

async function getBalance() {
  const url = `https://api.bscscan.com/api?module=account&action=balance&address=${ADDRESS}&tag=latest&apikey=${BSCSCAN_API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  return data.result || "0";
}

async function getTransactions() {
  const url = `https://api.bscscan.com/api?module=account&action=txlist&address=${ADDRESS}&startblock=0&endblock=99999999&sort=desc&apikey=${BSCSCAN_API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();

  // Evita erro se a resposta não for um array
  if (data.status !== "1" || !Array.isArray(data.result)) {
    console.warn("⚠️ Nenhuma transação encontrada ou erro:", data.message);
    return [];
  }

  return data.result.filter(tx => tx.to && tx.to.toLowerCase() === ADDRESS);
}

async function getBNBPrices() {
  const url = `https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd,brl&include_24hr_change=true`;
  const res = await fetch(url);
  const data = await res.json();
  return data.binancecoin;
}

function weiToBNB(wei) {
  return Number(wei) / 1e18;
}

function formatNumber(num, decimals = 4) {
  return Number(num).toLocaleString("pt-BR", { maximumFractionDigits: decimals });
}

async function loadData() {
  try {
    const [weiBalance, txs, priceData] = await Promise.all([
      getBalance(),
      getTransactions(),
      getBNBPrices()
    ]);

    const balanceBNB = weiToBNB(weiBalance);
    const usdPrice = priceData.usd;
    const brlPrice = priceData.brl;
    const change24h = priceData.usd_24h_change;

    const balanceUSD = balanceBNB * usdPrice;
    const balanceBRL = balanceBNB * brlPrice;

    const infoDiv = document.getElementById("wallet-info");
    infoDiv.innerHTML = `
      <strong>Endereço:</strong> ${ADDRESS}<br>
      <strong>Saldo:</strong> ${formatNumber(balanceBNB)} BNB<br>
      <strong>USD:</strong> $${formatNumber(balanceUSD, 2)}<br>
      <strong>BRL:</strong> R$${formatNumber(balanceBRL, 2)}<br>
      <strong>BNB 24h:</strong> 
      <span class="${change24h >= 0 ? 'positive' : 'negative'}">
        ${change24h.toFixed(2)}%
      </span>
    `;

    const tbody = document.querySelector("#tx-table tbody");
    const noTxDiv = document.getElementById("no-tx");
    tbody.innerHTML = "";

    if (txs.length === 0) {
      noTxDiv.style.display = "block";
    } else {
      noTxDiv.style.display = "none";
      txs.slice(0, 15).forEach(tx => {
        const date = new Date(tx.timeStamp * 1000).toLocaleString("pt-BR");
        const valueBNB = weiToBNB(tx.value);
        const row = `
          <tr>
            <td>${date}</td>
            <td>${tx.from.slice(0, 6)}...${tx.from.slice(-4)}</td>
            <td>${formatNumber(valueBNB)}</td>
            <td><a href="https://bscscan.com/tx/${tx.hash}" target="_blank">ver</a></td>
          </tr>
        `;
        tbody.insertAdjacentHTML("beforeend", row);
      });
    }

  } catch (err) {
    document.getElementById("wallet-info").innerHTML = "Erro ao carregar dados 😞";
    console.error(err);
  }
}

// Atualiza automaticamente a cada 60 segundos
loadData();
setInterval(loadData, 60000);
</script>

</body>
</html>
